# immich-middleware.yaml
apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: immich-upload
  namespace: immich
spec:
  buffering:
    maxRequestBodyBytes: 0              # 0 = unlimited (or set > image size)
    memRequestBodyBytes: 2097152       # 10MB in memory, rest in temp file
    maxResponseBodyBytes: 0             # unlimited response size
    memResponseBodyBytes: 2097152
    retryExpression: "IsNetworkError() && Attempts() <= 2" # only retry for network-level issues